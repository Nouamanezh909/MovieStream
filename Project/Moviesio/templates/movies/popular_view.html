{% extends "movies/base_view.html" %}

  {% block popular %}
    <div class="text-center pt-3">
      <h2 class="uppercases">Other Movies - Search by Category or name</h2>
    </div>

    <!-- //TODO:replace with ajax call -->

    <div class="relative text-center">
      <div class="search">

        <!-- TODO:specify the search url  -->
        <form action="/" method="POST">
          <input type="text" id="key_search" value="{{ request.form['key_search'] }}" name="key_search"
            class="bg-black rounded -full w-64 focus:outline-none  focus:shadow-outline" placeholder="search">
        </form>

        {% if query_str %}
        <div class="bg-red-100 rounded w-64 m-auto">
          <ul>
            {% for search_res in query_res.results %}
            <li>
              
              <a href="#" class="block hover:bg-gray-800">
                <img src="https://image.tmdb.org/t/p/w92/{{ search_res['poster_path'] }}" class="w-8" alt="poster">
                <span class="ml-4 pb-4"> {{ search_res['title'] }} </span>
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% else %}
        <spann href="#" class="block hover:bg-gray-800"></spann>
        {% endif %}
      </div>
    </div>

    <!-- get dynamique category from the api   -->
    <div class="left mt-6">
      <i id="arrowleft" class="fa fa-arrow-left" aria-hidden="true"></i>
    </div>
    <div class="center pb-16 gap-6 mt-6" id="content">
      {% for category in categories.genres %}
      <div class="internal">
        <a href="{{ url_for('moviesio.get_by_category', genre_id=category.id, genre_name=category.name ) }}">
          <button type="button" id="genre_{{ category.id }}" class="bg-red-500 text-white hover:bg-black text-gray-800 font-bold py-2 px-4 rounded-full genre_button
            " value="{{ category.name }}">
            {{ category['name'] }}
          </button>
        </a>
      </div>
      {% endfor %}
    </div>
    <div class="right mt-6">
      <i id="arrowright" class="fa fa-arrow-right text-black" aria-hidden="true"></i>
    </div>

    <!-- Cards rendering -->
    <div class="container mt-24 pt-24 mx-auto px-2 my-3">
      <div class="grid grid-cols-4 gap-16 mb-4">

        <!-- TODO: Done without ajax -->
        {% if genre_clicked %}
        {% for by_genre in genre_results.results %}
        <div class="mt-4">
          <i class="fas fa-star text-black"></i>
          <i class="fas fa-star text-black"></i>
          <i class="fas fa-star text-black"></i>

          <!-- redirect to detail page  -->
          <a href="{{ url_for('moviesio.movie_detail', movie_id=by_genre['id'] )}}">
            <!-- Poster path (images) -- from api -->
            <img src="https://image.tmdb.org/t/p/original{{by_genre['poster_path'] }}" alt="movie">
          </a>

          <div class="mt-2">
            <h3 href="#" class="m_link text-lg mt-2 ">
              <!--getting titles -->
              {{by_genre['title']}}
            </h3>
            <div class="flex items-center text-gray-700">
              <span> {{by_genre['release_date']}} </span>
              <span> || </span>
              <span>
                <!-- //FIXME: need to loop throug list of names[genres] not ids -->

              </span>
            </div>
          </div>
        </div>
        {% endfor %}

        {% else %}

        {% for popular in popular_movies.results %}
        <div class="mt-4">
          <i class="fas fa-star text-black"></i>
          <i class="fas fa-star text-black"></i>
          <i class="fas fa-star text-black"></i>

          <!-- redirect to detail page  -->
          <a href="{{ url_for('moviesio.movie_detail', movie_id=popular['id'] )}}">
            <!-- Poster path (images) -- from api -->
            <img src="https://image.tmdb.org/t/p/original{{popular['poster_path'] }}" alt="movie">
          </a>

          <div class="mt-2">
            <h3 href="#" class="m_link text-lg mt-2 ">
              <!--getting titles -->
              {{popular['title']}}
            </h3>
            <div class="flex items-center text-gray-700">
              <span> {{popular['release_date']}} </span>
              <span> || </span>
              <span>
                <!-- //FIXME: need to loop throug list of names[genres] not ids -->

              </span>
            </div>
          </div>
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>

    <!--  <!~~ Load More button  ~~> 
        <div class="wrapper">
          <button class="bg-red-500 text-white mt-5 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full">
            Load More
            <hr>
          </button> 
        </div> -->
    </div>
    {% endblock popular %}
 



